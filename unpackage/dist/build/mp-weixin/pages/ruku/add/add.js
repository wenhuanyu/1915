(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/ruku/add/add"],{"1e0c":function(t,i,e){"use strict";e.d(i,"b",(function(){return n})),e.d(i,"c",(function(){return o})),e.d(i,"a",(function(){return s}));var s={uniEasyinput:function(){return e.e("uni_modules/uni-easyinput/components/uni-easyinput/uni-easyinput").then(e.bind(null,"3c6f"))},uniPopup:function(){return e.e("uni_modules/uni-popup/components/uni-popup/uni-popup").then(e.bind(null,"3511"))}},n=function(){var t=this,i=t.$createElement;t._self._c},o=[]},"8d2f":function(t,i,e){},"9c7f":function(t,i,e){"use strict";e.r(i);var s=e("b75a"),n=e.n(s);for(var o in s)"default"!==o&&function(t){e.d(i,t,(function(){return s[t]}))}(o);i["default"]=n.a},b75a:function(t,i,e){"use strict";(function(t){i.__esModule=!0,i["default"]={data:function(){return{uid:0,warehouse:[],list:[{id:0,name:"",image:"",price:0,serial_num:"",num:0,total_num:0,total_price:0,cangku_id:"",gonghuo:"",gonghuo_id:"",clientId:0,clientName:""}],date:"",tel:"",remark:"",qIndex:0,touchStartX:0,touchStartY:0,newClientId:0,pIndex:0,clientId:0,clientName:"",showClient:!1,clientList:[],textClient:"",showGood:!1,goodList:[],textGood:"",itemIndex:0,preventEvent:!1,price_list:[],price_show:!1,nums:"",popups_go_num:1,result:"",kehu_num:1,showWarehouse:!1,textWarehouse:"",WarehouseName:"",WarehouseId:""}},mounted:function(){},onLoad:function(t){var i=this;t.id&&(this.newClientId=t.id),this.uid=this.common.get("uid"),this.http({url:this.api.merchantList,method:"POST",data:{uid:this.uid},success:function(t){if(i.clientList=t,i.newClientId>0)for(var e=0;e<i.clientList.length;e++)i.clientList[e].id==i.newClientId&&(i.clientId=i.newClientId,i.clientName=i.clientList[e].nick_name,i.tel=i.clientList[e].mobile)}})},methods:{chakanClick:function(t,i){var e=this;this.http({url:this.api.export_price_list,method:"POST",data:{uid:this.uid,goods_id:t.id},success:function(t){e.price_list=t,e.price_show=!0}})},priceChange:function(t,i){this.list[this.itemIndex].price=t.price,this.list[this.itemIndex].total_price=(this.list[this.itemIndex].price*this.list[this.itemIndex].num).toFixed(2)},hideIsShow:function(){this.price_show=!1},openModal:function(i,e){var s=this;this.preventEvent=!0,"client"==i?(this.showClient=!0,this.kehu_num=1):"good"==i?""==this.WarehouseId?t.showToast({title:"请先选择仓库",icon:"none"}):(this.itemIndex=e,this.showGood=!0,this.http({url:this.api.goods_list,method:"POST",data:{uid:this.uid,ware_id:this.WarehouseId},success:function(t){s.goodList=t}})):"clientlist"==i?(this.itemIndex=e,this.showClient=!0,this.kehu_num=2):"Warehouse"==i&&(this.showWarehouse=!0,this.http({url:this.api.warehouseList,method:"POST",data:{uid:this.uid},success:function(t){s.warehouse=t}}))},closeModal:function(t){this.preventEvent=!1,"client"==t?this.showClient=!1:"good"==t?this.showGood=!1:"clientlist"==t?this.showClient=!1:"Warehouse"==t&&(this.showWarehouse=!1)},searchWarehouse:function(){var t=this;this.http({url:this.api.warehouseList,method:"POST",data:{uid:this.uid,search_name:this.textWarehouse},success:function(i){t.warehouse=i}})},selectWarehouse:function(t){var i=this;this.showWarehouse=!1,this.WarehouseId=this.warehouse[t].id,this.WarehouseName=this.warehouse[t].warehouse_name,this.list.map((function(t){t.cangku_id=i.WarehouseId,t.cangku=i.WarehouseName,t.id&&i.http({url:i.api.goods_details,method:"POST",data:{uid:i.uid,goods_id:t.id,ware_id:i.WarehouseId,type:2},success:function(e){t.id=e.id,t.name=e.name,t.image=e.image,t.price=e.price,t.serial_num=e.serial_num,t.total_num=e.total_num,t.cangku_id=i.WarehouseId,t.cangku=i.WarehouseName,t.kehu_id=t.clientId,t.kehu=t.clientName,t.num=0}})}))},searchClient:function(){var t=this;this.http({url:this.api.client,method:"POST",data:{uid:this.uid,search_name:this.textClient},success:function(i){t.clientList=i}})},searchGood:function(t){var i=this;this.http({url:this.api.goods_list,method:"POST",data:{uid:this.uid,ware_id:this.WarehouseId,search_name:this.textGood},success:function(t){i.goodList=t}})},selectClient:function(t){var i=this;1==this.kehu_num?(this.clientId=this.clientList[t].id,this.clientName=this.clientList[t].nick_name,this.tel=this.clientList[t].mobile,this.list.map((function(e){e.clientId=i.clientList[t].id,e.clientName=i.clientList[t].nick_name,e.gonghuo_id=i.clientList[t].id,e.gonghuo=i.clientList[t].nick_name,e.tel=i.clientList[t].mobile}))):(this.list[this.itemIndex].clientId=this.clientList[t].id,this.list[this.itemIndex].clientName=this.clientList[t].nick_name,this.list[this.itemIndex].gonghuo_id=this.clientList[t].id,this.list[this.itemIndex].gonghuo=this.clientList[t].nick_name,this.list[this.itemIndex].tel=this.clientList[t].mobile),this.showClient=!1,this.preventEvent=!1},selectGood:function(i,e){var s=this;this.prevent=!1,this.showGood=!1;var n=this.goodList[i].id,o=this.isExist(n);o?t.showToast({title:"请勿重复添加商品",icon:"none"}):this.http({url:this.api.goods_details,method:"POST",data:{uid:this.uid,goods_id:n,ware_id:this.WarehouseId,type:1},success:function(t){s.list[s.itemIndex].id=n,s.list[s.itemIndex].name=t.name,s.list[s.itemIndex].image=t.image,s.list[s.itemIndex].price=t.price,s.list[s.itemIndex].serial_num=t.serial_num,s.list[s.itemIndex].total_num=t.total_num,s.list[s.itemIndex].gonghuo=s.clientName,s.list[s.itemIndex].gonghuo_id=s.clientId,s.list[s.itemIndex].cangku_id=s.WarehouseId,s.list[s.itemIndex].cangku=s.WarehouseName}})},previewImage:function(t){wx.previewImage({current:t,urls:[t]})},previewGood:function(t){wx.previewImage({current:this.goodList[t].image,urls:[this.goodList[t].image]})},close:function(){this.preventEvent=!1},qrcode:function(){var i=this;""==i.WarehouseId?t.showToast({title:"请先选择仓库",icon:"none"}):t.scanCode({success:function(e){console.log("条码类型："+e.scanType),console.log("条码内容："+e.result),i.http({url:i.api.goods_details,method:"POST",data:{uid:i.uid,ware_id:i.WarehouseId,bar_code:e.result,type:1},success:function(e){i.result=e;var s=i.isExist(e.id);if(s)return t.showToast({title:"请勿重复添加商品",icon:"none"}),void i.$refs.popups.close();""==i.list[i.list.length-1].id?(i.$refs.popups.open(),i.assignment()):(i.$refs.popups.open(),i.add(),i.assignment())}})}})},assignment:function(){var t=this;t.list[t.list.length-1].id=t.result.id,t.list[t.list.length-1].name=t.result.name,t.list[t.list.length-1].image=t.result.image,t.list[t.list.length-1].price=t.result.price,t.list[t.list.length-1].serial_num=t.result.serial_num,t.list[t.list.length-1].total_num=t.result.total_num,t.list[t.list.length-1].cangku_id=t.WarehouseId,t.list[t.list.length-1].cangku=t.WarehouseName,t.list[t.list.length-1].gonghuo_id=t.clientId,t.list[t.list.length-1].gonghuo=t.clientName},popups_submit:function(){this.list[this.list.length-1].num=this.nums,this.list[this.list.length-1].total_price=(this.list[this.list.length-1].price*this.nums).toFixed(2),this.$refs.popups.close()},popups_go:function(){this.list[this.list.length-1].num=this.nums,this.list[this.list.length-1].total_price=(this.list[this.list.length-1].price*this.nums).toFixed(2),this.popups_go_num=2,this.qrcode(),this.nums=""},add:function(){var t={id:0,name:"",image:"",price:0,serial_num:"",num:0,total_num:0,total_price:0,cangku_id:"",gonghuo:"",gonghuo_id:"",clientId:this.clientId,clientName:this.clientName};this.list.push(t)},del:function(i){1==this.list.length?t.showToast({title:"最少入库一个商品",icon:"none",duration:2e3}):this.list.splice(i,1)},num:function(t,i){""==t&&(t=0),this.list[i].num=t,this.list[i].total_price=(this.list[i].price*this.list[i].num).toFixed(2)},price:function(t,i){console.log("e",t),""==t&&(t=0),this.list[i].price=t,this.list[i].total_price=(this.list[i].price*this.list[i].num).toFixed(2)},isExist:function(t){for(var i=!1,e=0;e<this.list.length;e++)this.list[e].id==t&&(i=!0);return i},updatePriceArr:function(){for(var t=[],i=0;i<this.list.length;i++)0!=this.list[i].id&&t.push(this.list[i]);return t},previous:function(){var i=getCurrentPages(),e=i[i.length-2];t.navigateBack({success:function(){e.onLoad()}})},submit:function(){var i=this;t.showModal({title:"提示",content:"确定当前操作吗？",success:function(e){e.confirm&&i.http({url:i.api.be_put,method:"POST",data:{uid:i.uid,info:JSON.stringify(i.updatePriceArr(i.list)),remark:i.remark},success:function(e){t.showToast({title:"入库成功",icon:"none",duration:2e3}),setTimeout((function(){i.previous()}),500)}})},fail:function(){},complete:function(){}})}}}}).call(this,e("d5d0")["default"])},c57b:function(t,i,e){"use strict";var s=e("8d2f"),n=e.n(s);n.a},d47c:function(t,i,e){"use strict";(function(t){e("2e6c");s(e("dc04"));var i=s(e("da08"));function s(t){return t&&t.__esModule?t:{default:t}}wx.__webpack_require_UNI_MP_PLUGIN__=e,t(i.default)}).call(this,e("97ff")["createPage"])},da08:function(t,i,e){"use strict";e.r(i);var s=e("1e0c"),n=e("9c7f");for(var o in n)"default"!==o&&function(t){e.d(i,t,(function(){return n[t]}))}(o);e("c57b");var u,h=e("f0c5"),l=Object(h["a"])(n["default"],s["b"],s["c"],!1,null,null,null,!1,s["a"],u);i["default"]=l.exports}},[["d47c","common/runtime","common/vendor"]]]);